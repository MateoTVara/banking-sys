{% extends "bankingsys/index.html" %}
{% load static %}

{% block title %}Apertura de Cuenta{% endblock %}

{% block styles %}
 <link rel="stylesheet" href="{% static 'css/accounts/register.css' %}?v=1">
{% endblock %}

{% block content %}
<div class="account-opening-card">
  <h4>üìã Apertura de Nueva Cuenta</h4>
  <form method="post">
    {% csrf_token %}
    {% if form.non_field_errors %}
    <div class="alert alert-danger">
      {% for error in form.non_field_errors %}
        {{ error }}
      {% endfor %}
    </div>
    {% endif %}

    <div class="account-form-grid">
      <div class="account-form-col">
        <label class="form-label">{{ form.client.label }}</label>
        {{ form.client }}
        {% if form.client.errors %}
        <div class="alert alert-danger">{{ form.client.errors }}</div>
        {% endif %}
      </div>
      <div class="account-form-col">
        <label class="form-label">{{ form.account_type.label }}</label>
        {{ form.account_type }}
        {% if form.account_type.errors %}
        <div class="alert alert-danger">{{ form.account_type.errors }}</div>
        {% endif %}
      </div>
      <div class="account-form-col">
        <label class="form-label">{{ form.currency.label }}</label>
        {{ form.currency }}
        {% if form.currency.errors %}
        <div class="alert alert-danger">{{ form.currency.errors }}</div>
        {% endif %}
      </div>
      <div class="account-form-col">
        <label class="form-label">{{ form.initial_deposit.label }}</label>
        {{ form.initial_deposit }}
        {% if form.initial_deposit.errors %}
        <div class="alert alert-danger">{{ form.initial_deposit.errors }}</div>
        {% endif %}
      </div>
    </div>

    <!-- Campos espec√≠ficos para cuenta corriente -->
    <div id="current-account-fields" class="account-form-grid" style="display: none;">
        <div class="account-form-col">
          <label class="form-label">{{ form.overdraft_limit.label }}</label>
          {{ form.overdraft_limit }}
          <small class="form-text text-muted">L√≠mite de sobregiro permitido</small>
          {% if form.overdraft_limit.errors %}
          <div class="alert alert-danger">{{ form.overdraft_limit.errors }}</div>
          {% endif %}
        </div>
    </div>

    <!-- Campos espec√≠ficos para cuenta a plazos -->
    <div id="term-account-fields" class="account-form-grid" style="display: none;">
      <div class="account-form-col">
        <label class="form-label">{{ form.term_months.label }}</label>
        {{ form.term_months }}
        {% if form.term_months.errors %}
        <div class="alert alert-danger">{{ form.term_months.errors }}</div>
        {% endif %}
      </div>
      <div class="account-form-col">
        <label class="form-label">{{ form.monthly_interest.label }}</label>
        {{ form.monthly_interest }}
        <small class="form-text text-muted">Tasa de inter√©s mensual en porcentaje</small>
        {% if form.monthly_interest.errors %}
        <div class="alert alert-danger">{{ form.monthly_interest.errors }}</div>
        {% endif %}
      </div>
    </div>

    <div class="account-form-actions">
      <button type="submit" class="btn btn-primary">Abrir Cuenta</button>
      <a href="{% url 'bankingsys:accounts' %}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>

  <div class="card-info">
    <h6>‚ÑπÔ∏è Informaci√≥n sobre tipos de cuenta</h6>
    <ul>
      <li>‚úÖ <strong>Cuenta de Ahorro:</strong> M√≠nimo S/ 10. Sin sobregiro.</li>
      <li>‚úÖ <strong>Cuenta Corriente:</strong> Permite sobregiro. M√≠nimo S/ 100.</li>
      <li>‚úÖ <strong>Cuenta a Plazos:</strong> M√≠nimo S/ 1000. Tasa de inter√©s fija.</li>
    </ul>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('main').classList.add('account-register-body');
    
    const accountTypeSelect = document.getElementById('id_account_type');
    const currentFields = document.getElementById('current-account-fields');
    const termFields = document.getElementById('term-account-fields');
    
    function toggleFields() {
      const selectedType = accountTypeSelect.value;
      currentFields.style.display = 'none';
      termFields.style.display = 'none';
      if (selectedType === 'current') {
        currentFields.style.display = 'grid';
      } else if (selectedType === 'term') {
        termFields.style.display = 'grid';
      }
    }
    if (accountTypeSelect) {
      accountTypeSelect.addEventListener('change', toggleFields);
      toggleFields();
    }
  });
</script>
{% endblock %}