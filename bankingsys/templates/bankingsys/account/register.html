{% extends "bankingsys/index.html" %}
{% load static %}

{% block title %}Apertura de Cuenta{% endblock %}

{% block styles %}
 <link rel="stylesheet" href="{% static 'css/accounts/register.css' %}?v=1">
{% endblock %}

{% block content %}
<div class="actions-bar">
  <button>Agregar</button>
  <input type="text">
</div>
<table>
  <thead>
    <th>Cliente</th>
    <th>N¬∞</th>
    <th>Tipo de Cuenta</th>
    <th>Moneda</th>
    <th>Saldo</th>
    <th>estado</th>
    <th>acciones</th>
  </thead>
  <tbody>
  {% for account in accounts %}
    <tr>
      <td>{{ account.client.name }}</td>
      <td>{{ account.account_number }}</td>
      <td>{{ account.get_account_type_display }}</td>
      <td>{{ account.get_currency_display }}</td>
      <td>{{ account.balance }}</td>
      <td>{{ account.get_status_display }}</td>
      <td>
        <a href="{% url 'bankingsys:account_edit' %}?account={{ account.id }}">Editar</a>
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="7">No hay cuentas registradas.</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<div class="account-register-container">
  <div class="account-opening-card">
    <h4>üìã Apertura de Nueva Cuenta</h4>
    <form method="post">
      {% csrf_token %}
      {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
          {{ error }}
        {% endfor %}
      </div>
      {% endif %}

      <div class="account-form-grid">
        <div class="account-form-col">
          <label class="form-label">{{ form.client.label }}</label>
          {{ form.client }}
          {% if form.client.errors %}
          <div class="alert alert-danger">{{ form.client.errors }}</div>
          {% endif %}
        </div>
        <div class="account-form-col">
          <label class="form-label">{{ form.account_type.label }}</label>
          {{ form.account_type }}
          {% if form.account_type.errors %}
          <div class="alert alert-danger">{{ form.account_type.errors }}</div>
          {% endif %}
        </div>
        <div class="account-form-col">
          <label class="form-label">{{ form.currency.label }}</label>
          {{ form.currency }}
          {% if form.currency.errors %}
          <div class="alert alert-danger">{{ form.currency.errors }}</div>
          {% endif %}
        </div>
        <div class="account-form-col">
          <label class="form-label">{{ form.initial_deposit.label }}</label>
          {{ form.initial_deposit }}
          {% if form.initial_deposit.errors %}
          <div class="alert alert-danger">{{ form.initial_deposit.errors }}</div>
          {% endif %}
        </div>
      </div>

      <!-- Campos espec√≠ficos para cuenta corriente -->
      <div id="current-account-fields" class="account-form-grid" style="display: none;">
          <div class="account-form-col">
            <label class="form-label">{{ form.overdraft_limit.label }}</label>
            {{ form.overdraft_limit }}
            <small class="form-text text-muted">L√≠mite de sobregiro permitido</small>
            {% if form.overdraft_limit.errors %}
            <div class="alert alert-danger">{{ form.overdraft_limit.errors }}</div>
            {% endif %}
          </div>
      </div>

      <!-- Campos espec√≠ficos para cuenta a plazos -->
      <div id="term-account-fields" class="account-form-grid" style="display: none;">
        <div class="account-form-col">
          <label class="form-label">{{ form.term_months.label }}</label>
          {{ form.term_months }}
          {% if form.term_months.errors %}
          <div class="alert alert-danger">{{ form.term_months.errors }}</div>
          {% endif %}
        </div>
        <div class="account-form-col">
          <label class="form-label">{{ form.monthly_interest.label }}</label>
          {{ form.monthly_interest }}
          <small class="form-text text-muted">Tasa de inter√©s mensual en porcentaje</small>
          {% if form.monthly_interest.errors %}
          <div class="alert alert-danger">{{ form.monthly_interest.errors }}</div>
          {% endif %}
        </div>
      </div>

      <div class="account-form-actions">
        <button type="submit" class="btn btn-primary">Abrir Cuenta</button>
        <a href="{% url 'bankingsys:account_register' %}" class="btn btn-secondary">Cancelar</a>
      </div>
    </form>

    <div class="card-info">
      <h6>‚ÑπÔ∏è Informaci√≥n sobre tipos de cuenta</h6>
      <ul>
        <li>‚úÖ <strong>Cuenta de Ahorro:</strong> M√≠nimo S/ 10. Sin sobregiro.</li>
        <li>‚úÖ <strong>Cuenta Corriente:</strong> Permite sobregiro. M√≠nimo S/ 100.</li>
        <li>‚úÖ <strong>Cuenta a Plazos:</strong> M√≠nimo S/ 1000. Tasa de inter√©s fija.</li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}