{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Sistema Bancario{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=1">
  {% block styles %} {% endblock %}
  <script src="{% static 'js/pnpm_modules/chart.js' %}?v=1" defer></script>
  <script type="module" src="{% static 'js/script.js' %}?v=1" defer></script>
</head>
<body class="active-nav">
  <header>
    <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu">â‰¡</button>
    {% block header %}
      <h1>Sistema Bancario</h1>
    {% endblock %}
    {% if messages %}
    <div class="messages">
      {% for message in messages %}
      <div class="message {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %}
  </header>
  <nav class="active">
    {% block nav %}
    <ul>
      <li><a href="{% url 'bankingsys:index' %}">Home</a></li>
      <li><a href="{% url 'bankingsys:client_register' %}">Registrar Clientes</a></li>
      <li><a href="{% url 'bankingsys:account_register' %}">Registrar Cuentas</a></li>
      <li><a href="{% url 'bankingsys:judicial_hold_register' %}">Embargos Judiciales</a></li>
      <li>
        <p>Listas</p>
        <ul class="nav-item">
          <li><a href="{% url 'bankingsys:tests' %}">Pruebas</a></li>
          <li><a href="{% url 'bankingsys:users' %}">Usuarios</a></li>
          <li><a href="{% url 'bankingsys:clients' %}">Clientes</a></li>
          <li><a href="{% url 'bankingsys:accounts' %}">Cuentas</a></li>
          <li><a href="{% url 'bankingsys:judicial_holds' %}">Embargos Judiciales</a></li>
          <li><a href="{% url 'bankingsys:account_movements' %}">Movimientos de Cuenta</a></li>
        </ul>
      </li>
      <li><a href="{% url 'bankingsys:logout' %}">Logout</a></li>
    </ul>
    {% endblock %}
  </nav>
  <main>
    {% block content %}
    <div class="dashboard-container">
      <section class="cards-container">
        <div class="dashboard-card">
          <h3>Clientes</h3>
          <p class="dashboard-value">{{ clients_count|default:"-" }}</p>
          <a href="{% url 'bankingsys:client_register' %}">Ver todos</a>
        </div>
        <div class="dashboard-card">
          <h3>Cuentas</h3>
          <p class="dashboard-value">{{ accounts_count|default:"-" }}</p>
          <a href="{% url 'bankingsys:account_register' %}">Ver todas</a>
        </div>
        <div class="dashboard-card">
          <h3>Embargos Judiciales</h3>
          <p class="dashboard-value">{{ judicial_holds_count|default:"-" }}</p>
          <a href="{% url 'bankingsys:judicial_hold_register' %}">Ver todos</a>
        </div>
        <div class="dashboard-card">
          <h3>Movimientos de Cuenta</h3>
          <p class="dashboard-value">{{ account_movements_count|default:"-" }}</p>
          <a href="{% url 'bankingsys:account_movements' %}">Ver todos</a>
        </div>
      </section>
      <div class="chart-container bar"><canvas id="movementsBarChart"></canvas></div>
      <div class="chart-container line"><canvas id="movementsLineChart"></canvas></div>
    </div>
    <script>
      // Bar chart
      document.addEventListener("DOMContentLoaded", () => {
        // document.querySelector('main').classList.add('dashboard');

        const colors = {
          deposit: '#36a2eb',
          withdrawal: '#ff6384',
          transfer: '#ffcd56',
          renewal: '#4bc0c0',
          cancellation: '#9966ff'
        }

        const ctx = document.getElementById('movementsBarChart').getContext('2d');
        const labels = {{ movement_labels|safe }};
        const data = {
          labels: labels,
          datasets: [{
            label: 'Movimientos de Cuenta',
            data: [
              {% for value in movement_counts.values %}
                {{ value }},
              {% endfor %}
            ],
            backgroundColor: [
              colors.deposit, 
              colors.withdrawal, 
              colors.transfer, 
              colors.renewal, 
              colors.cancellation
            ],
          }]
        };
        new Chart(ctx, {
          type: 'bar',
          data: data,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              title: { display: true, text: 'Movimientos de Cuenta por Tipo' }
            }
          }
        });

        // Line chart
        const lineCtx = document.getElementById('movementsLineChart').getContext('2d');
        const lineLabels = {{ movement_dates|safe }};
        const lineData = {
          labels: lineLabels,
          datasets: [{
            label: 'Movimientos por Fecha',
            data: {{ movement_date_counts|safe }},
            fill: false,
            borderColor: '#36a2eb',
            tension: 0.1
          }]
        };
        new Chart(lineCtx, {
          type: 'line',
          data: lineData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: true },
              title: { display: true, text: 'Movimientos de Cuenta por Fecha' }
            },
            scales: {
              x: { title: { display: true, text: 'Fecha' } },
              y: { title: { display: true, text: 'Cantidad' }, beginAtZero: true }
            }
          }
        });
      });
    </script>
    {% endblock %}
  </main>
</body>
</html>